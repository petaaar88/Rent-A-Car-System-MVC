<div xmlns:th="http://www.thymeleaf.org" th:fragment="reservation-form(car)">
    <form th:action="@{/reservations}" method="post" class="border p-3 rounded shadow-sm">
        <input type="hidden" name="carId" th:value="${car.id}" />

        <div class="mb-3">
            <label for="startDate" class="form-label">Start Date</label>
            <input type="date" id="startDate" name="startDate" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="endDate" class="form-label">End Date</label>
            <input type="date" id="endDate" name="endDate" class="form-control" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Price Per Day</label>
            <input type="text" class="form-control bg-transparent" th:value="${car.pricePerDay}" id="pricePerDay" readonly>
        </div>

        <div class="mb-3">
            <label class="form-label">Total Price</label>
            <input type="text" class="form-control bg-transparent" id="totalPrice" readonly>
        </div>

        <button type="submit" class="btn btn-primary">Reserve</button>
    </form>


    <script>
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        const todayStr = `${yyyy}-${mm}-${dd}`;

        const startDateInput = document.getElementById('startDate');
        const endDateInput = document.getElementById('endDate');
        const pricePerDayInput = document.getElementById('pricePerDay');
        const totalPriceInput = document.getElementById('totalPrice');

        startDateInput.min = todayStr;
        startDateInput.value = todayStr;

        endDateInput.min = todayStr;
        endDateInput.value = todayStr;

        function calculateTotal() {
            const startDate = new Date(startDateInput.value);
            const endDate = new Date(endDateInput.value);
            const pricePerDay = parseFloat(pricePerDayInput.value);

            if (!isNaN(startDate) && !isNaN(endDate) && endDate >= startDate) {
                const diffTime = endDate - startDate;
                const days = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1; // uključuje i poslednji dan
                const total = days * pricePerDay;
                totalPriceInput.value = total.toFixed(2) + " $";
            } else {
                totalPriceInput.value = "";
            }
        }

        startDateInput.addEventListener('change', () => {
            endDateInput.min = startDateInput.value;
            if (endDateInput.value < startDateInput.value) {
                endDateInput.value = startDateInput.value;
            }
            calculateTotal();
        });

        endDateInput.addEventListener('change', calculateTotal);

        calculateTotal();
    </script>


</div>
